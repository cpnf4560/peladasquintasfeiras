<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gest√£o de Coletes - Peladas das Quintas Feiras</title>
  <link rel="stylesheet" href="/style.base.css">
  <link rel="stylesheet" href="/style.layout.css">
  <link rel="stylesheet" href="/style.tables.css">
  <link rel="stylesheet" href="/style.cards.css">
  <link rel="stylesheet" href="/style.forms.css">
  <link rel="stylesheet" href="/style.css?v=<%= Date.now() %>">
</head>
<body class="main-bg">
  <%- include('partials/header', { user: user }) %>

  <main class="container">
    <h2>Gest√£o de Coletes</h2>
    <!-- Estado actual dos coletes -->
    <div class="coletes-status">
      <% if (coletesActuais) { %>
        <div class="alert alert-info">
          <h3>ü•Ö Coletes actualmente com:</h3>
          <p><strong><%= coletesActuais.jogador_nome %></strong></p>
          <p>Desde: <%= new Date(coletesActuais.data_levou).toLocaleDateString('pt-PT') %></p>
        </div>
      <% } else { %>
        <div class="alert alert-warning">
          <h3>‚ö†Ô∏è Coletes dispon√≠veis</h3>
          <p>Ningu√©m tem os coletes neste momento.</p>
        </div>
      <% } %>
      
      <!-- Informa√ß√£o do pr√≥ximo convocado -->
      <% if (proximoConvocado) { %>
        <div class="alert alert-success" style="margin-top: 15px;">
          <h3>üéØ Pr√≥ximo a levar os coletes:</h3>
          <p><strong><%= proximoConvocado.nome %></strong></p>
          <p>
            Vezes que j√° levou: <strong><%= proximoConvocado.vezes_levou %></strong>
            <% if (proximoConvocado.ultima_vez) { %>
              | √öltima vez: <%= new Date(proximoConvocado.ultima_vez).toLocaleDateString('pt-PT') %>
            <% } else { %>
              | <em>Nunca levou os coletes</em>
            <% } %>
          </p>
          <% if (!coletesActuais) { %>
            <form method="POST" action="/coletes/atribuir" style="margin-top: 10px;">
              <input type="hidden" name="jogador_id" value="<%= proximoConvocado.id %>">
              <button type="submit" class="btn btn-primary">
                üì• Atribuir Coletes a <%= proximoConvocado.nome %>
              </button>
            </form>
          <% } %>
        </div>
      <% } %>
    </div>    <!-- Tabela de estat√≠sticas -->
    <div class="coletes-stats card-visual">
      <h3>üìä Estat√≠sticas dos Convocados</h3>
      <p><em>Apenas os 10 convocados podem levar os coletes</em></p>
      <% if (estatisticas.length > 0) { %>
        <table class="table stats-table">
          <thead>
            <tr>
              <th>Posi√ß√£o</th>
              <th>Jogador</th>
              <th>Posi√ß√£o Convocat√≥ria</th>
              <th>Vezes que Levou</th>
              <th>√öltima Vez</th>
              <th>Prioridade</th>
              <th>Ac√ß√£o</th>
            </tr>
          </thead>
          <tbody>
            <% estatisticas.forEach((jogador, index) => { %>
              <tr class="<%= index < 3 ? 'priority-high' : '' %> <%= index % 2 === 0 ? 'zebra' : '' %>">
                <td><%= index + 1 %>¬∫</td>
                <td><%= jogador.nome %></td>
                <td><%= jogador.posicao %>¬∫ Convocado</td>
                <td><%= jogador.vezes_levou %></td>
                <td>
                  <% if (jogador.ultima_vez) { %>
                    <%= new Date(jogador.ultima_vez).toLocaleDateString('pt-PT') %>
                  <% } else { %>
                    <em>Nunca</em>
                  <% } %>
                </td>
                <td>
                  <% if (index === 0) { %>
                    <span class="priority-badge high">üî• ALTA</span>
                  <% } else if (index < 3) { %>
                    <span class="priority-badge medium">‚ö° M√âDIA</span>
                  <% } else { %>
                    <span class="priority-badge low">üí§ BAIXA</span>
                  <% } %>
                </td>
                <td>
                  <% if (!coletesActuais) { %>
                    <form method="POST" action="/coletes/atribuir" style="display: inline;">
                      <input type="hidden" name="jogador_id" value="<%= jogador.id %>">
                      <button type="submit" class="btn btn-primary btn-sm">
                        üì• Atribuir Coletes
                      </button>
                    </form>
                  <% } %>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      <% } else { %>
        <p>Nenhum jogador dispon√≠vel.</p>
      <% } %>
    </div>

    <!-- Sugest√£o autom√°tica -->
    <% if (!coletesActuais && estatisticas.length > 0) { %>
      <div class="suggestion">
        <h3>üí° Sugest√£o Autom√°tica</h3>
        <p>Pr√≥ximo jogador sugerido: <strong><%= estatisticas[0].nome %></strong></p>
        <p>
          <% if (estatisticas[0].vezes_levou === 0) { %>
            (Nunca levou os coletes)
          <% } else { %>
            (Levou <%= estatisticas[0].vezes_levou %> vez<%= estatisticas[0].vezes_levou > 1 ? 'es' : '' %>)
          <% } %>
        </p>
        
        <form method="POST" action="/coletes/atribuir">
          <input type="hidden" name="jogador_id" value="<%= estatisticas[0].id %>">
          <button type="submit" class="btn btn-primary btn-large">
            üéØ Atribuir ao Pr√≥ximo da Lista
          </button>
        </form>
      </div>    <% } %>
  </main>

  <%- include('partials/footer') %>
</body>
</html>
