<!DOCTYPE html>
<html>
<head>  <title>Estat铆sticas - Peladas das Quintas Feiras</title>
  <link rel="stylesheet" href="/style.css?v=20250101">
  <link rel="icon" type="image/svg+xml" href="/logo.svg">
  <link rel="shortcut icon" href="/logo.svg">
</head>
<body class="main-bg">
  <%- include('partials/header', { user: user, activePage: 'estatisticas' }) %>

  <main class="container">    <h2 class="section-title"> Estat铆sticas dos Jogadores</h2>

    <!-- Filtros Horizontais -->
    <div class="stats-filters-horizontal">
      <div class="filter-item">
        <label for="ano"> Ano</label>
        <select id="ano" onchange="updateEstats()" class="filter-select">
          <option value="2024" <%= anoSelecionado === '2024' ? 'selected' : '' %>>2024</option>
          <option value="2025" <%= anoSelecionado === '2025' ? 'selected' : '' %>>2025</option>
          <option value="2026" <%= anoSelecionado === '2026' ? 'selected' : '' %>>2026</option>
          <option value="2027" <%= anoSelecionado === '2027' ? 'selected' : '' %>>2027</option>
        </select>
      </div>
      <div class="filter-item">
        <label for="mes"> M锚s</label>
        <select id="mes" onchange="updateEstats()" class="filter-select">
          <option value="" <%= mesSelecionado === '' ? 'selected' : '' %>>Todos</option>
          <option value="1" <%= mesSelecionado === '1' ? 'selected' : '' %>>Janeiro</option>
          <option value="2" <%= mesSelecionado === '2' ? 'selected' : '' %>>Fevereiro</option>
          <option value="3" <%= mesSelecionado === '3' ? 'selected' : '' %>>Mar莽o</option>
          <option value="4" <%= mesSelecionado === '4' ? 'selected' : '' %>>Abril</option>
          <option value="5" <%= mesSelecionado === '5' ? 'selected' : '' %>>Maio</option>
          <option value="6" <%= mesSelecionado === '6' ? 'selected' : '' %>>Junho</option>
          <option value="7" <%= mesSelecionado === '7' ? 'selected' : '' %>>Julho</option>
          <option value="8" <%= mesSelecionado === '8' ? 'selected' : '' %>>Agosto</option>
          <option value="9" <%= mesSelecionado === '9' ? 'selected' : '' %>>Setembro</option>
          <option value="10" <%= mesSelecionado === '10' ? 'selected' : '' %>>Outubro</option>
          <option value="11" <%= mesSelecionado === '11' ? 'selected' : '' %>>Novembro</option>
          <option value="12" <%= mesSelecionado === '12' ? 'selected' : '' %>>Dezembro</option>
        </select>
      </div>      <div class="filter-item">
        <label for="ordenacao"> Ordenar por</label>
        <select id="ordenacao" onchange="updateEstats()" class="filter-select">
          <option value="mediaPontos" <%= ordenacaoSelecionada === 'mediaPontos' ? 'selected' : '' %>>M茅dia de Pontos/Jogo</option>
          <option value="pontos" <%= ordenacaoSelecionada === 'pontos' ? 'selected' : '' %>>Pontos</option>
          <option value="percentagem" <%= ordenacaoSelecionada === 'percentagem' ? 'selected' : '' %>>% de Vit贸rias</option>
        </select>
      </div>
    </div><!-- Curiosidades/Observa莽玫es -->
    <% if (curiosidades && curiosidades.length > 0) { %>
      <div class="curiosidades-section">
        <h3 class="curiosidades-title"> Curiosidades & Observa莽玫es</h3>
        <div class="curiosidades-grid-3col">
          <% curiosidades.forEach(curiosidade => { %>
            <div class="curiosidade-card-compact">
              <span class="curiosidade-icon-large"><%= curiosidade.icone %></span>
              <h4 class="curiosidade-titulo-compact"><%= curiosidade.titulo %></h4>
              <p class="curiosidade-texto-compact"><%= curiosidade.texto %></p>
            </div>
          <% }) %>
        </div>
      </div>
    <% } %>    <!-- An谩lise de Duplas -->
    <% var duplasSafe = typeof duplas !== 'undefined' && duplas ? duplas : { melhorVitorias: [], piorVitorias: [], maisJogos: [], menosJogos: [] }; %>
    <% if (duplasSafe.melhorVitorias && duplasSafe.melhorVitorias.length > 0) { %>
      <div class="duplas-section-compact">
        <h3 class="duplas-title"> An谩lise de Duplas</h3>
        <p class="duplas-subtitle-small"><em>M铆nimo 3 jogos juntos</em></p>
        
        <!-- TOP 3 - Melhor % Vit贸rias -->
        <div class="dupla-categoria-compact">
          <h4 class="dupla-header-compact">
             TOP 3 - Melhores Duplas
          </h4>
          <div class="duplas-compact-grid">
            <% duplasSafe.melhorVitorias.forEach((dupla, idx) => { %>
              <div class="dupla-card-mini <%= idx === 0 ? 'gold' : idx === 1 ? 'silver' : 'bronze' %>">
                <div class="dupla-rank">#<%= idx + 1 %></div>
                <div class="dupla-names"><%= dupla.jogador1 %> & <%= dupla.jogador2 %></div>
                <div class="dupla-stat-main"><strong><%= dupla.percentagem_vitorias %>%</strong> vit贸rias</div>
                <div class="dupla-stats-mini">
                  <span><%= dupla.vitorias %>V</span> 路 
                  <span><%= dupla.empates || 0 %>E</span> 路 
                  <span><%= dupla.derrotas || 0 %>D</span> 路 
                  <span><%= dupla.jogos_juntos %>J</span>
                </div>
              </div>
            <% }) %>
          </div>        </div>

        <!-- TOP 3 - Pior % Vit贸rias -->
        <div class="dupla-categoria-compact">
          <h4 class="dupla-header-compact">
             TOP 3 - Piores Duplas
          </h4>
          <div class="duplas-compact-grid">
            <% duplasSafe.piorVitorias.forEach((dupla, idx) => { %>
              <div class="dupla-card-mini worst">
                <div class="dupla-rank">#<%= idx + 1 %></div>
                <div class="dupla-names"><%= dupla.jogador1 %> & <%= dupla.jogador2 %></div>
                <div class="dupla-stat-main"><strong><%= dupla.percentagem_vitorias %>%</strong> vit贸rias</div>
                <div class="dupla-stats-mini">
                  <span><%= dupla.vitorias %>V</span> 路 
                  <span><%= dupla.empates || 0 %>E</span> 路 
                  <span><%= dupla.derrotas || 0 %>D</span> 路 
                  <span><%= dupla.jogos_juntos %>J</span>
                </div>
              </div>
            <% }) %>
          </div>
        </div>

        <!-- TOP 3 - Mais Jogos Juntos -->
        <div class="dupla-categoria-compact">
          <h4 class="dupla-header-compact">
             TOP 3 - Duplas com Mais Jogos Juntos
          </h4>
          <div class="duplas-compact-grid">
            <% duplasSafe.maisJogos.forEach((dupla, idx) => { %>
              <div class="dupla-card-mini veteran">
                <div class="dupla-rank">#<%= idx + 1 %></div>
                <div class="dupla-names"><%= dupla.jogador1 %> & <%= dupla.jogador2 %></div>
                <div class="dupla-stat-main"><strong><%= dupla.jogos_juntos %></strong> jogos juntos</div>
                <div class="dupla-stats-mini">
                  <span><%= dupla.vitorias %>V</span> 路 
                  <span><%= dupla.empates || 0 %>E</span> 路 
                  <span><%= dupla.derrotas || 0 %>D</span> 路 
                  <span><%= dupla.percentagem_vitorias %>%</span>
                </div>
              </div>
            <% }) %>
          </div>
        </div>        <!-- TOP 3 - Menos Jogos Juntos -->
        <div class="dupla-categoria-compact">
          <h4 class="dupla-header-compact">
             TOP 3 - Duplas com Menos Jogos Juntos
          </h4>
          <div class="duplas-compact-grid">
            <% duplasSafe.menosJogos.forEach((dupla, idx) => { %>
              <div class="dupla-card-mini new">
                <div class="dupla-rank">#<%= idx + 1 %></div>
                <div class="dupla-names"><%= dupla.jogador1 %> & <%= dupla.jogador2 %></div>
                <div class="dupla-stat-main"><strong><%= dupla.jogos_juntos %></strong> jogos juntos</div>
                <div class="dupla-stats-mini">
                  <span><%= dupla.vitorias %>V</span> 路 
                  <span><%= dupla.empates || 0 %>E</span> 路 
                  <span><%= dupla.derrotas || 0 %>D</span> 路 
                  <span><%= dupla.percentagem_vitorias %>%</span>
                </div>
              </div>
            <% }) %>
          </div>
        </div>
      </div>
    <% } %>

    <!-- MVP Mensal -->
    <% if (mesSelecionado && mvpMensais && mvpMensais.length > 0) { %>
      <div class="mvp-section">
        <h3 class="mvp-title"> MVP<%= mvpMensais.length > 1 ? 's' : '' %> do M锚s</h3>
        <% if (mvpMensais.length > 1) { %>
          <p class="mvp-empate"><em>Empate no MVP! <%= mvpMensais.length %> jogadores empatados com <%= mvpMensais[0].pontos %> pontos</em></p>
        <% } %>
        <div class="mvp-cards">
          <% mvpMensais.forEach(mvp => { %>
            <div class="mvp-card">
              <div class="mvp-info">
                <h4><%= mvp.nome %></h4>
                <p><strong><%= mvp.pontos %> pontos</strong> | <%= mvp.jogos %>/<%= totalJogosMes %> jogos (<%= Math.round((mvp.jogos/totalJogosMes)*100) %>%)</p>
                <p><%= mvp.vitorias %>V <%= mvp.empates %>E <%= mvp.derrotas %>D | +<%= mvp.diferenca_golos %> diferen莽a de golos</p>
              </div>
            </div>
          <% }) %>
        </div>        <p class="mvp-criteria"><em>Crit茅rio: M铆nimo <%= minimoJogosParaMVP %> jogos (75% dos jogos do m锚s)</em></p>
      </div>
    <% } else if (mesSelecionado && totalJogosMes > 0 && (!mvpMensais || mvpMensais.length === 0)) { %>
      <div class="mvp-section">
        <div class="alert alert-warning">
          <h3>锔 MVP do M锚s</h3>
          <p>Nenhum jogador qualificado para MVP (m铆nimo <%= minimoJogosParaMVP %> jogos de <%= totalJogosMes %> total)</p>
        </div>
      </div>
    <% } %><!-- Crit茅rios de Classifica莽茫o -->
    <div class="classification-criteria">
      <h4> Crit茅rios de Classifica莽茫o <span style="color: #f9b233;">(Ordena莽茫o atual: <%= ordenacaoSelecionada === 'percentagem' ? '% de Vit贸rias' : ordenacaoSelecionada === 'mediaPontos' ? 'M茅dia de Pontos/Jogo' : 'Pontos' %>)</span></h4>
      <% if (ordenacaoSelecionada === 'percentagem') { %>
        <ol>
          <li><strong>% de Vit贸rias</strong> (crit茅rio principal)</li>
          <li><strong>Diferen莽a de golos</strong> (em caso de empate de %)</li>
          <li><strong>Golos marcados</strong> (em caso de empate de diferen莽a)</li>
          <li><strong>N煤mero de presen莽as</strong> (em caso de empate de golos)</li>
        </ol>
      <% } else if (ordenacaoSelecionada === 'mediaPontos') { %>
        <ol>
          <li><strong>M茅dia de Pontos/Jogo (MP):</strong> Pontos totais 梅 Jogos (Vit贸ria = 3pts, Empate = 1pt, Derrota = 0pts)</li>
          <li><strong>Diferen莽a de golos</strong> (em caso de empate de m茅dia)</li>
          <li><strong>Golos marcados</strong> (em caso de empate de diferen莽a)</li>
          <li><strong>N煤mero de presen莽as</strong> (em caso de empate de golos)</li>
        </ol>
      <% } else { %>
        <ol>
          <li><strong>Pontos:</strong> Vit贸ria = 3pts, Empate = 1pt, Derrota = 0pts</li>
          <li><strong>Diferen莽a de golos</strong> (em caso de empate de pontos)</li>
          <li><strong>Golos marcados</strong> (em caso de empate de diferen莽a)</li>
          <li><strong>N煤mero de presen莽as</strong> (em caso de empate de golos)</li>
        </ol>
      <% } %>
      <% if (mesSelecionado) { %>
        <p><strong>MVP Mensal:</strong> Jogador(es) com mais pontos tendo participado em pelo menos 75% dos jogos do m锚s</p>
      <% } %>
    </div><table class="stats-table">
      <thead>
        <tr>
          <th>Pos</th>
          <th>Jogador</th>
          <th>MP</th>
          <th>Pontos</th>
          <th>Jogos</th>
          <th>Vit贸rias</th>
          <th>Empates</th>
          <th>Derrotas</th>
          <th>% Vit贸rias</th>
          <th>Golos Marcados</th>
          <th>Golos Sofridos</th>
          <th>Diferen莽a</th>
        </tr>
      </thead>
      <tbody>
        <% if (estatisticas && estatisticas.length > 0) { %>
          <% estatisticas.forEach((stat, index) => { %>            <tr class="<%= mvpMensais && mvpMensais.some(mvp => mvp.id === stat.id) ? 'mvp-row' : '' %>">
              <td class="position"><%= index + 1 %>潞</td>
              <td class="player-name">
                <%= stat.nome %>
                <% if (mvpMensais && mvpMensais.some(mvp => mvp.id === stat.id)) { %>
                  <span class="mvp-badge"> MVP</span>
                <% } %>
              </td>
              <td class="stat-media-pontos"><strong><%= stat.media_pontos.toFixed(2) %></strong></td>
              <td class="stat-points"><strong><%= stat.pontos %></strong></td>
              <td><%= stat.jogos %></td>
              <td class="stat-wins"><%= stat.vitorias %></td>
              <td class="stat-draws"><%= stat.empates %></td>
              <td class="stat-losses"><%= stat.derrotas %></td>
              <td class="stat-percentage"><%= stat.percentagem_vitorias %>%</td>
              <td class="stat-goals-for"><%= stat.golos_marcados %></td>
              <td class="stat-goals-against"><%= stat.golos_sofridos %></td>
              <td class="stat-goal-diff <%= stat.diferenca_golos >= 0 ? 'positive' : 'negative' %>">
                <%= stat.diferenca_golos >= 0 ? '+' : '' %><%= stat.diferenca_golos %>
              </td>
            </tr>
          <% }) %>        <% } else { %>
          <tr>
            <td colspan="12" style="text-align: center;">Nenhuma estat铆stica encontrada para o per铆odo selecionado</td>
          </tr>
        <% } %>
      </tbody>
    </table>
  </main>
  <script>
  function updateEstats() {
    const ano = document.getElementById('ano').value;
    const mes = document.getElementById('mes').value;
    const ordenacao = document.getElementById('ordenacao').value;
    const url = `/estatisticas?ano=${ano}${mes ? '&mes=' + mes : ''}${ordenacao ? '&ordenacao=' + ordenacao : ''}`;
    window.location.href = url;
  }
  </script>
</body>
</html>