<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">  <title>GestÃ£o de Coletes - Peladas das Quintas Feiras</title>
  <link rel="stylesheet" href="/style.css?v=20250101">
  <link rel="icon" type="image/svg+xml" href="/logo.svg">
  <link rel="shortcut icon" href="/logo.svg">
</head>
<body class="main-bg">  <%- include('partials/header', { user: user }) %>
  <main class="container">
    <div class="coletes-header-modern">
      <h2 class="section-title">ðŸŸ¢ðŸ”´ GestÃ£o de Coletes</h2>
      <p class="section-subtitle">Controlo de quem leva os coletes</p>
    </div>
      <!-- Estado actual dos coletes -->    <div class="coletes-status-modern">
      <% if (coletesActuais) { %>
        <div class="status-card current-holder">
          <div class="status-icon">ðŸ‘•</div>
          <div class="status-content">
            <h3>Coletes actualmente com:</h3>
            <p class="holder-name"><%= coletesActuais.jogador_nome %></p>
            <p class="holder-date">ðŸ“… Desde: <%= new Date(coletesActuais.data_levou).toLocaleDateString('pt-PT') %></p>
          </div>
        </div>
      <% } else { %>
        <div class="status-card available">
          <div class="status-icon">âœ…</div>
          <div class="status-content">
            <h3>Coletes DisponÃ­veis</h3>
            <p>NinguÃ©m tem os coletes neste momento</p>
          </div>
        </div>
      <% } %>
      
      <!-- InformaÃ§Ã£o do prÃ³ximo convocado -->
      <% if (proximoConvocado) { %>
        <div class="alert alert-success" style="margin-top: 15px;">
          <h3>ðŸŽ¯ PrÃ³ximo a levar os coletes:</h3>
          <p><strong><%= proximoConvocado.nome %></strong></p>
          <p>
            Vezes que jÃ¡ levou: <strong><%= proximoConvocado.vezes_levou %></strong>
            <% if (proximoConvocado.ultima_vez) { %>
              | Ãšltima vez: <%= new Date(proximoConvocado.ultima_vez).toLocaleDateString('pt-PT') %>
            <% } else { %>
              | <em>Nunca levou os coletes</em>
            <% } %>          </p>
          <% if (user && user.role === 'admin') { %>
            <% if (!coletesActuais) { %>
            <form method="POST" action="/coletes/atribuir" style="margin-top: 10px;">
              <input type="hidden" name="jogador_id" value="<%= proximoConvocado.id %>">
              <button type="submit" class="btn btn-primary">
                ðŸ“¥ Atribuir Coletes a <%= proximoConvocado.nome %>
              </button>
            </form>
            <% } %>
          <% } %>
        </div>
      <% } %>
    </div>    <!-- Tabela de estatÃ­sticas -->
    <div class="coletes-stats card-visual">
      <h3>ðŸ“Š EstatÃ­sticas dos Convocados</h3>
      <p><em>Apenas os 10 convocados podem levar os coletes</em></p>
      <% if (estatisticas.length > 0) { %>
        <table class="table stats-table">
          <thead>
            <tr>
              <th>PosiÃ§Ã£o</th>
              <th>Jogador</th>
              <th>PosiÃ§Ã£o ConvocatÃ³ria</th>
              <th>Vezes que Levou</th>
              <th>Ãšltima Vez</th>
              <th>Prioridade</th>
              <th>AcÃ§Ã£o</th>
            </tr>
          </thead>
          <tbody>
            <% estatisticas.forEach((jogador, index) => { %>
              <tr class="<%= index < 3 ? 'priority-high' : '' %> <%= index % 2 === 0 ? 'zebra' : '' %>">
                <td><%= index + 1 %>Âº</td>
                <td><%= jogador.nome %></td>
                <td><%= jogador.posicao %>Âº Convocado</td>
                <td><%= jogador.vezes_levou %></td>
                <td>
                  <% if (jogador.ultima_vez) { %>
                    <%= new Date(jogador.ultima_vez).toLocaleDateString('pt-PT') %>
                  <% } else { %>
                    <em>Nunca</em>
                  <% } %>
                </td>
                <td>
                  <% if (index === 0) { %>
                    <span class="priority-badge high">ðŸ”¥ ALTA</span>
                  <% } else if (index < 3) { %>
                    <span class="priority-badge medium">âš¡ MÃ‰DIA</span>
                  <% } else { %>
                    <span class="priority-badge low">ðŸ’¤ BAIXA</span>
                  <% } %>                </td>
                <td>
                  <% if (user && user.role === 'admin') { %>
                    <% if (!coletesActuais) { %>
                    <form method="POST" action="/coletes/atribuir" style="display: inline;">
                      <input type="hidden" name="jogador_id" value="<%= jogador.id %>">
                      <button type="submit" class="btn btn-primary btn-sm">
                        ðŸ“¥ Atribuir Coletes
                      </button>
                    </form>
                    <% } %>
                  <% } %>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      <% } else { %>
        <p>Nenhum jogador disponÃ­vel.</p>
      <% } %>
    </div>

    <!-- SugestÃ£o automÃ¡tica -->
    <% if (!coletesActuais && estatisticas.length > 0) { %>
      <div class="suggestion">
        <h3>ðŸ’¡ SugestÃ£o AutomÃ¡tica</h3>
        <p>PrÃ³ximo jogador sugerido: <strong><%= estatisticas[0].nome %></strong></p>
        <p>
          <% if (estatisticas[0].vezes_levou === 0) { %>
            (Nunca levou os coletes)
          <% } else { %>
            (Levou <%= estatisticas[0].vezes_levou %> vez<%= estatisticas[0].vezes_levou > 1 ? 'es' : '' %>)
          <% } %>        </p>
        
        <% if (user && user.role === 'admin') { %>
        <form method="POST" action="/coletes/atribuir">
          <input type="hidden" name="jogador_id" value="<%= estatisticas[0].id %>">
          <button type="submit" class="btn btn-primary btn-large">
            ðŸŽ¯ Atribuir ao PrÃ³ximo da Lista
          </button>
        </form>
        <% } %>
      </div><% } %>
  </main>

  <%- include('partials/footer') %>
</body>
</html>
