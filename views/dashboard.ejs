<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - Futsal Manager</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #2a2e44;
      color: #f5f5f5;
      padding: 20px;
    }
    .header {
      background: #33384d;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .card {
      background: #33384d;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    .card h2 {
      color: #f9b233;
      border-bottom: 2px solid #f9b233;
      padding-bottom: 10px;
    }
    .btn {
      background: #f9b233;
      color: #2a2e44;
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      text-decoration: none;
      margin: 5px;
    }
    .btn-logout {
      background: #dc3545;
      color: white;
    }
  </style>
</head>
<body>
  <!-- Header with user info -->
  <div class="header">
    <div>
      <h1>ğŸ“Š Dashboard - Futsal Manager</h1>
      <p>Bem-vindo, <strong><%= user.username %></strong> (<%= user.role === 'admin' ? 'Administrador' : 'Utilizador' %>)</p>
    </div>
    <div>
      <% if (user.role === 'admin') { %>
        <a href="/" class="btn">ğŸ  InÃ­cio</a>
        <a href="/jogadores" class="btn">ğŸ‘¥ Jogadores</a>
      <% } else { %>
        <a href="/estatisticas" class="btn">ğŸ“Š EstatÃ­sticas</a>
        <a href="/coletes" class="btn">ğŸ‘• Coletes</a>
        <a href="/convocatoria" class="btn">ğŸ“‹ ConvocatÃ³ria</a>
      <% } %>
      <form action="/logout" method="POST" style="display: inline;">
        <button type="submit" class="btn btn-logout">ğŸšª Sair</button>
      </form>
    </div>
  </div>

  <!-- Debug info -->
  <div class="card">
    <h2>ğŸ”§ InformaÃ§Ãµes de Debug</h2>
    <p><strong>UsuÃ¡rio:</strong> <%= user.username %> (<%= user.role %>)</p>
    <p><strong>ConvocatÃ³ria:</strong> <%= convocatoria ? convocatoria.length : 0 %> jogadores</p>
    <p><strong>EstatÃ­sticas:</strong> <%= estatisticas ? estatisticas.length : 0 %> registros</p>
    <p><strong>Coletes Info:</strong> <%= coletesInfo ? coletesInfo.length : 0 %> registros</p>
    <p><strong>Ãšltimos Resultados:</strong> <%= ultimosResultados ? ultimosResultados.length : 0 %> jogos</p>
    <p><strong>Ano Atual:</strong> <%= anoAtual %></p>
    <p><strong>OrdenaÃ§Ã£o:</strong> <%= ordenacaoSelecionada %></p>
  </div>

  <!-- ConvocatÃ³ria -->
  <% if (convocatoria && convocatoria.length > 0) { %>
    <div class="card">
      <h2>ğŸ“‹ ConvocatÃ³ria Atual</h2>
      <p><strong>Total:</strong> <%= convocatoria.length %> jogadores</p>
      <h3>ğŸ‘¥ Convocados</h3>
      <% convocatoria.filter(j => j.tipo === 'convocado').forEach(jogador => { %>
        <p><%= jogador.posicao %>. <strong><%= jogador.nome %></strong> - 
        <%= jogador.confirmado === 1 ? 'âœ… Confirmado' : (jogador.confirmado === 0 ? 'âŒ Rejeitado' : 'â³ Pendente') %>
        </p>
      <% }); %>
      
      <h3>ğŸ”„ Reservas</h3>
      <% convocatoria.filter(j => j.tipo === 'reserva').forEach(jogador => { %>
        <p>R<%= jogador.posicao %>. <strong><%= jogador.nome %></strong> - 
        <%= jogador.confirmado === 1 ? 'âœ… Confirmado' : (jogador.confirmado === 0 ? 'âŒ Rejeitado' : 'â³ Pendente') %>
        </p>
      <% }); %>
    </div>
  <% } %>

  <!-- EstatÃ­sticas Top 10 -->
  <% if (estatisticas && estatisticas.length > 0) { %>
    <div class="card">
      <h2>ğŸ“Š Top 10 EstatÃ­sticas <%= anoAtual %></h2>
      <table style="width: 100%; border-collapse: collapse; background: #2a2e44;">
        <thead>
          <tr style="background: #181c27; color: #f9b233;">
            <th style="padding: 8px; border: 1px solid #444;">Pos</th>
            <th style="padding: 8px; border: 1px solid #444;">Jogador</th>
            <th style="padding: 8px; border: 1px solid #444;">Jogos</th>
            <th style="padding: 8px; border: 1px solid #444;">VitÃ³rias</th>
            <th style="padding: 8px; border: 1px solid #444;">Pontos</th>
            <th style="padding: 8px; border: 1px solid #444;">%VitÃ³rias</th>
          </tr>
        </thead>
        <tbody>
          <% estatisticas.slice(0, 10).forEach((stat, index) => { %>
            <tr style="<%= index % 2 === 0 ? 'background: rgba(51, 56, 77, 0.3);' : '' %>">
              <td style="padding: 8px; border: 1px solid #444; text-align: center;"><%= index + 1 %></td>
              <td style="padding: 8px; border: 1px solid #444;"><strong><%= stat.nome %></strong></td>
              <td style="padding: 8px; border: 1px solid #444; text-align: center;"><%= stat.jogos %></td>
              <td style="padding: 8px; border: 1px solid #444; text-align: center;"><%= stat.vitorias %></td>
              <td style="padding: 8px; border: 1px solid #444; text-align: center;"><strong><%= stat.pontos %></strong></td>
              <td style="padding: 8px; border: 1px solid #444; text-align: center;"><%= stat.percentagem_vitorias %>%</td>
            </tr>
          <% }); %>
        </tbody>
      </table>
    </div>
  <% } %>

  <!-- Coletes -->
  <% if (coletesInfo || proximoColetes) { %>
    <div class="card">
      <h2>ğŸ‘• GestÃ£o de Coletes</h2>
      <% if (coletesInfo && coletesInfo.length > 0) { %>
        <h3>ğŸƒ Quem tem coletes:</h3>
        <% coletesInfo.forEach(colete => { %>
          <p><strong><%= colete.nome %></strong> - Levou em <%= new Date(colete.data_levou).toLocaleDateString('pt-PT') %></p>
        <% }); %>
      <% } %>
      
      <% if (proximoColetes) { %>
        <h3>ğŸ‘¤ PrÃ³ximo a levar coletes:</h3>
        <p><strong><%= proximoColetes.nome %></strong> (PosiÃ§Ã£o <%= proximoColetes.posicao %>)</p>
      <% } %>
    </div>
  <% } %>

  <!-- Links de navegaÃ§Ã£o -->
  <div class="card">
    <h2>ğŸ”— NavegaÃ§Ã£o</h2>
    <a href="/dashboard?ordenacao=percentagem" class="btn">ğŸ“ˆ Ordenar por % VitÃ³rias</a>
    <a href="/dashboard?ordenacao=pontos" class="btn">ğŸ† Ordenar por Pontos</a>
    <% if (user.role === 'user') { %>
      <a href="/estatisticas" class="btn">ğŸ“Š Ver EstatÃ­sticas Completas</a>
      <a href="/convocatoria" class="btn">ğŸ“‹ Ver ConvocatÃ³ria</a>
      <a href="/coletes" class="btn">ğŸ‘• Ver Coletes</a>
    <% } %>
  </div>
</body>
</html>
