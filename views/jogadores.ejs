<!DOCTYPE html>
<html>
<head>
  <title>Peladas das Quintas Feiras</title>
  <link rel="stylesheet" href="/style.base.css">
  <link rel="stylesheet" href="/style.layout.css">
  <link rel="stylesheet" href="/style.tables.css">
  <link rel="stylesheet" href="/style.cards.css">
  <link rel="stylesheet" href="/style.forms.css">
  <link rel="stylesheet" href="/style.css?v=<%= Date.now() %>">
  <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700&display=swap" rel="stylesheet">
</head>
<body class="main-bg">  

<%- include('partials/header', { user: user }) %>

  <h2 class="section-title">Administração de Jogadores</h2>

  <form method="POST" action="/jogadores" class="form-add-player">
    <div class="form-group">
      <label for="nome">Nome do Jogador:</label>
      <input type="text" id="nome" name="nome" required>
    </div>
    <button type="submit" class="btn">Adicionar Jogador</button>
  </form>

  <div class="players-table-container">
    <table class="players-table">
      <thead>
        <tr>
          <th>Nome</th>
          <th>Estado</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody>
        <% if (jogadores && jogadores.length > 0) { %>
          <% jogadores.forEach(jogador => { %>
            <tr class="<%= jogador.suspenso ? 'player-suspended' : '' %>">
              <td>
                <span class="player-name-display" id="name-display-<%= jogador.id %>"><%= jogador.nome %></span>
                <input type="text" class="player-name-edit" id="name-edit-<%= jogador.id %>" value="<%= jogador.nome %>" style="display: none;">
              </td>
              <td>
                <span class="player-status <%= jogador.suspenso ? 'status-suspended' : 'status-active' %>">
                  <%= jogador.suspenso ? 'Inativo' : 'Ativo' %>
                </span>
              </td>
              <td class="player-actions">
                <button class="btn-small btn-edit" data-player-id="<%= jogador.id %>">Editar</button>
                <button class="btn-small btn-save" data-player-id="<%= jogador.id %>" style="display: none;">Guardar</button>
                <button class="btn-small btn-cancel" data-player-id="<%= jogador.id %>" style="display: none;">Cancelar</button>
                <form method="POST" action="/jogadores/<%= jogador.id %>/toggle-suspension" style="display: inline;">
                  <button type="submit" class="btn-small <%= jogador.suspenso ? 'btn-activate' : 'btn-suspend' %>">
                    <%= jogador.suspenso ? 'Ativar' : 'Inativar' %>
                  </button>
                </form>
                <form method="POST" action="/jogadores/<%= jogador.id %>/delete" style="display: inline;" onsubmit="return confirm('Tem certeza que deseja eliminar este jogador?')">
                  <button type="submit" class="btn-small btn-delete">Eliminar</button>
                </form>
              </td>
            </tr>
          <% }) %>
        <% } else { %>
          <tr>
            <td colspan="3" style="text-align: center;">Nenhum jogador encontrado</td>
          </tr>
        <% } %>
      </tbody>
    </table>
  </div>

  <script>
  // Event delegation for player row actions (edit/save/cancel)
  document.addEventListener('click', function(e) {
    const editBtn = e.target.closest('.btn-edit');
    const saveBtn = e.target.closest('.btn-save');
    const cancelBtn = e.target.closest('.btn-cancel');

    if (editBtn) {
      const id = editBtn.dataset.playerId;
      document.getElementById('name-display-' + id).style.display = 'none';
      document.getElementById('name-edit-' + id).style.display = 'inline';
      editBtn.style.display = 'none';
      const row = editBtn.closest('tr');
      row.querySelector('.btn-save').style.display = 'inline';
      row.querySelector('.btn-cancel').style.display = 'inline';
    }

    if (cancelBtn) {
      const id = cancelBtn.dataset.playerId;
      document.getElementById('name-display-' + id).style.display = 'inline';
      document.getElementById('name-edit-' + id).style.display = 'none';
      const row = cancelBtn.closest('tr');
      row.querySelector('.btn-edit').style.display = 'inline';
      row.querySelector('.btn-save').style.display = 'none';
      row.querySelector('.btn-cancel').style.display = 'none';
    }

    if (saveBtn) {
      const id = saveBtn.dataset.playerId;
      const newName = document.getElementById('name-edit-' + id).value;
      fetch('/jogadores/' + id + '/update', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ nome: newName })
      }).then(() => location.reload());
    }
  });
  </script>

<%- include('partials/footer') %>

</body>
</html>