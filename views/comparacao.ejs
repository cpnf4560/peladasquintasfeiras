<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
  <meta name="description" content="Compara√ß√£o de Jogadores - Peladas das Quintas Feiras">
  <meta name="theme-color" content="#2c3e50">
  <title>Compara√ß√£o de Jogadores - Peladas das Quintas Feiras</title>
  <link rel="stylesheet" href="/style.css?v=<%= Date.now() %>">
  <link rel="stylesheet" href="/mobile.css?v=<%= Date.now() %>">  <link rel="icon" type="image/svg+xml" href="/logo.svg">
  <link rel="shortcut icon" href="/logo.svg">
</head>
<body class="main-bg">
  <%- include('partials/header', { user: user }) %>
  
  <main class="container">
    <div class="comparacao-header-modern">
      <h2 class="section-title">üÜö Compara√ß√£o de Jogadores</h2>
      <p class="section-subtitle">Compare o desempenho de dois jogadores juntos e um contra o outro</p>
    </div>

    <!-- Formul√°rio de Sele√ß√£o -->
    <div class="comparacao-form-card">
      <form method="POST" action="/comparacao/comparar" class="comparacao-form">
        <div class="form-row">          <div class="form-group">
            <label for="jogador1_id">üîµ Jogador 1</label>
            <select name="jogador1_id" id="jogador1_id" required class="select-modern">
              <option value="">Selecione o jogador...</option>
              <% jogadores.forEach(jogador => { %>
                <option value="<%= jogador.id %>" <%= typeof jogador1_id !== 'undefined' && jogador1_id == jogador.id ? 'selected' : '' %>>
                  <%= jogador.nome %>
                </option>
              <% }); %>
            </select>
          </div>

          <div class="vs-separator">
            <span class="vs-badge">VS</span>
          </div>

          <div class="form-group">
            <label for="jogador2_id">üî¥ Jogador 2</label>
            <select name="jogador2_id" id="jogador2_id" required class="select-modern">
              <option value="">Selecione o jogador...</option>
              <% jogadores.forEach(jogador => { %>
                <option value="<%= jogador.id %>" <%= typeof jogador2_id !== 'undefined' && jogador2_id == jogador.id ? 'selected' : '' %>>
                  <%= jogador.nome %>
                </option>
              <% }); %>
            </select>
          </div>
        </div>

        <button type="submit" class="btn-comparar">
          üîç Comparar Jogadores
        </button>
      </form>
    </div>

    <% if (jogador1 && jogador2) { %>
      <!-- Cabe√ßalho com Nomes dos Jogadores -->
      <div class="comparacao-players-header">
        <div class="player-badge player1">
          <div class="player-icon">üîµ</div>
          <div class="player-name"><%= jogador1.nome %></div>
        </div>
        <div class="vs-divider">VS</div>
        <div class="player-badge player2">
          <div class="player-icon">üî¥</div>
          <div class="player-name"><%= jogador2.nome %></div>
        </div>
      </div>

      <!-- ESTAT√çSTICAS COMO DUPLA -->
      <div class="stats-section">
        <div class="stats-header">
          <h3>ü§ù Como Dupla (mesma equipa)</h3>
          <p>Estat√≠sticas quando <%= jogador1.nome %> e <%= jogador2.nome %> jogam juntos</p>
        </div>

        <% if (estatisticasDupla && estatisticasDupla.jogos_juntos > 0) { %>
          <div class="stats-grid">
            <div class="stat-card stat-primary">
              <div class="stat-icon">üéÆ</div>
              <div class="stat-value"><%= estatisticasDupla.jogos_juntos %></div>
              <div class="stat-label">Jogos Juntos</div>
            </div>

            <div class="stat-card stat-success">
              <div class="stat-icon">‚úÖ</div>
              <div class="stat-value"><%= estatisticasDupla.vitorias || 0 %></div>
              <div class="stat-label">Vit√≥rias</div>
              <div class="stat-percentage">
                <%= estatisticasDupla.jogos_juntos > 0 ? ((estatisticasDupla.vitorias / estatisticasDupla.jogos_juntos) * 100).toFixed(1) : 0 %>%
              </div>
            </div>

            <div class="stat-card stat-warning">
              <div class="stat-icon">ü§ù</div>
              <div class="stat-value"><%= estatisticasDupla.empates || 0 %></div>
              <div class="stat-label">Empates</div>
              <div class="stat-percentage">
                <%= estatisticasDupla.jogos_juntos > 0 ? ((estatisticasDupla.empates / estatisticasDupla.jogos_juntos) * 100).toFixed(1) : 0 %>%
              </div>
            </div>

            <div class="stat-card stat-danger">
              <div class="stat-icon">‚ùå</div>
              <div class="stat-value"><%= estatisticasDupla.derrotas || 0 %></div>
              <div class="stat-label">Derrotas</div>
              <div class="stat-percentage">
                <%= estatisticasDupla.jogos_juntos > 0 ? ((estatisticasDupla.derrotas / estatisticasDupla.jogos_juntos) * 100).toFixed(1) : 0 %>%
              </div>
            </div>

            <div class="stat-card stat-info">
              <div class="stat-icon">‚öΩ</div>
              <div class="stat-value"><%= estatisticasDupla.golos_marcados || 0 %></div>
              <div class="stat-label">Golos Marcados</div>
            </div>

            <div class="stat-card stat-info">
              <div class="stat-icon">ü•Ö</div>
              <div class="stat-value"><%= estatisticasDupla.golos_sofridos || 0 %></div>
              <div class="stat-label">Golos Sofridos</div>
            </div>

            <div class="stat-card stat-highlight">
              <div class="stat-icon">üìä</div>
              <div class="stat-value">
                <%= (estatisticasDupla.golos_marcados || 0) - (estatisticasDupla.golos_sofridos || 0) > 0 ? '+' : '' %><%= (estatisticasDupla.golos_marcados || 0) - (estatisticasDupla.golos_sofridos || 0) %>
              </div>
              <div class="stat-label">Diferen√ßa de Golos</div>
            </div>

            <div class="stat-card stat-highlight">
              <div class="stat-icon">üéØ</div>
              <div class="stat-value">
                <%= estatisticasDupla.jogos_juntos > 0 ? ((estatisticasDupla.golos_marcados || 0) / estatisticasDupla.jogos_juntos).toFixed(1) : 0 %>
              </div>
              <div class="stat-label">M√©dia Golos/Jogo</div>
            </div>
          </div>
        <% } else { %>
          <div class="empty-state">
            <div class="empty-icon">ü§∑‚Äç‚ôÇÔ∏è</div>
            <p>Estes jogadores nunca jogaram juntos na mesma equipa</p>
          </div>
        <% } %>
      </div>

      <!-- ESTAT√çSTICAS DE CONFRONTOS DIRETOS -->
      <div class="stats-section">
        <div class="stats-header">
          <h3>‚öîÔ∏è Confrontos Diretos</h3>
          <p>Estat√≠sticas quando <%= jogador1.nome %> e <%= jogador2.nome %> jogam um contra o outro</p>
        </div>

        <% if (estatisticasConfronto && estatisticasConfronto.total_confrontos > 0) { %>
          <div class="confronto-summary">
            <div class="confronto-total">
              <div class="total-icon">‚öîÔ∏è</div>
              <div class="total-value"><%= estatisticasConfronto.total_confrontos %></div>
              <div class="total-label">Total de Confrontos</div>
            </div>
          </div>

          <div class="confronto-grid">
            <div class="confronto-card player1-card">
              <div class="confronto-header">
                <div class="player-icon-small">üîµ</div>
                <h4><%= jogador1.nome %></h4>
              </div>
              <div class="confronto-stats">
                <div class="confronto-stat-big">
                  <div class="stat-number"><%= estatisticasConfronto.vitorias_jogador1 || 0 %></div>
                  <div class="stat-text">Vit√≥rias</div>
                </div>
                <div class="confronto-percentage">
                  <div class="percentage-bar">
                    <div class="percentage-fill player1-fill" style="width: <%= estatisticasConfronto.total_confrontos > 0 ? ((estatisticasConfronto.vitorias_jogador1 / estatisticasConfronto.total_confrontos) * 100).toFixed(1) : 0 %>%"></div>
                  </div>
                  <div class="percentage-text">
                    <%= estatisticasConfronto.total_confrontos > 0 ? ((estatisticasConfronto.vitorias_jogador1 / estatisticasConfronto.total_confrontos) * 100).toFixed(1) : 0 %>%
                  </div>
                </div>
              </div>
            </div>

            <div class="confronto-empates">
              <div class="empates-icon">ü§ù</div>
              <div class="empates-value"><%= estatisticasConfronto.empates_confronto || 0 %></div>
              <div class="empates-label">Empates</div>
              <div class="empates-percentage">
                <%= estatisticasConfronto.total_confrontos > 0 ? ((estatisticasConfronto.empates_confronto / estatisticasConfronto.total_confrontos) * 100).toFixed(1) : 0 %>%
              </div>
            </div>

            <div class="confronto-card player2-card">
              <div class="confronto-header">
                <div class="player-icon-small">üî¥</div>
                <h4><%= jogador2.nome %></h4>
              </div>
              <div class="confronto-stats">
                <div class="confronto-stat-big">
                  <div class="stat-number"><%= estatisticasConfronto.vitorias_jogador2 || 0 %></div>
                  <div class="stat-text">Vit√≥rias</div>
                </div>
                <div class="confronto-percentage">
                  <div class="percentage-bar">
                    <div class="percentage-fill player2-fill" style="width: <%= estatisticasConfronto.total_confrontos > 0 ? ((estatisticasConfronto.vitorias_jogador2 / estatisticasConfronto.total_confrontos) * 100).toFixed(1) : 0 %>%"></div>
                  </div>
                  <div class="percentage-text">
                    <%= estatisticasConfronto.total_confrontos > 0 ? ((estatisticasConfronto.vitorias_jogador2 / estatisticasConfronto.total_confrontos) * 100).toFixed(1) : 0 %>%
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Balan√ßo Final -->
          <div class="balanco-final">
            <% 
              const v1 = estatisticasConfronto.vitorias_jogador1 || 0;
              const v2 = estatisticasConfronto.vitorias_jogador2 || 0;
              let vencedor = null;
              if (v1 > v2) vencedor = jogador1.nome;
              else if (v2 > v1) vencedor = jogador2.nome;
            %>
            <% if (vencedor) { %>
              <div class="vencedor-badge">
                <span class="trophy-icon">üèÜ</span>
                <span class="vencedor-text"><strong><%= vencedor %></strong> lidera nos confrontos diretos!</span>
              </div>
            <% } else { %>
              <div class="empate-badge">
                <span class="trophy-icon">‚öñÔ∏è</span>
                <span class="empate-text">Confronto <strong>equilibrado</strong>!</span>
              </div>
            <% } %>
          </div>
        <% } else { %>
          <div class="empty-state">
            <div class="empty-icon">‚öîÔ∏è</div>
            <p>Estes jogadores nunca jogaram um contra o outro</p>
          </div>
        <% } %>
      </div>
    <% } %>
  </main>

  <%- include('partials/footer') %>
</body>
</html>
