<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GestÃ£o de Coletes - Peladas das Quintas Feiras</title>
  <link rel="stylesheet" href="/style.base.css">
  <link rel="stylesheet" href="/style.layout.css">
  <link rel="stylesheet" href="/style.tables.css">
  <link rel="stylesheet" href="/style.cards.css">
  <link rel="stylesheet" href="/style.forms.css">
  <link rel="stylesheet" href="/style.css?v=<%= Date.now() %>">
</head>
<body class="main-bg">  <header class="header">
    <div class="logo-area">
      <img src="/logo.svg" alt="Logo" class="logo-image">
      <span class="logo-text">Peladas das<br>Quintas Feiras</span>
    </div>    <nav class="navbar">
      <a href="/convocatoria" class="nav-link">ConvocatÃ³ria</a>
      <a href="/coletes" class="nav-link active">Coletes</a>
      <a href="/" class="nav-link">Resultados</a>
      <a href="/estatisticas" class="nav-link">EstatÃ­sticas</a>
      <% if (user && user.role === 'admin') { %>
        <a href="/jogos/novo" class="nav-link">Registar Resultado</a>
        <a href="/jogadores" class="nav-link">Admin</a>
      <% } %>
    </nav>
    
    <% if (user) { %>
      <div class="user-info">
        <span class="username">ğŸ‘¤ <%= user.username %></span>
        <% if (user.role === 'admin') { %>
          <span class="user-role">Admin</span>
        <% } else { %>
          <a href="/dashboard" class="dashboard-link">ğŸ“Š Dashboard</a>
        <% } %>
        <form method="POST" action="/logout" style="display: inline;">
          <button type="submit" class="logout-btn">ğŸšª Logout</button>
        </form>
      </div>
    <% } %>
  </header>

  <main class="container">
    <h2>GestÃ£o de Coletes</h2>
      <!-- Estado actual dos coletes -->
    <div class="coletes-status">
      <% if (coletesActuais) { %>
        <div class="alert alert-info">
          <h3>ğŸ¥… Coletes actualmente com:</h3>
          <p><strong><%= coletesActuais.jogador_nome %></strong></p>
          <p>Desde: <%= new Date(coletesActuais.data_levou).toLocaleDateString('pt-PT') %></p>
        </div>
      <% } else { %>
        <div class="alert alert-warning">
          <h3>âš ï¸ Coletes disponÃ­veis</h3>
          <p>NinguÃ©m tem os coletes neste momento.</p>
        </div>
      <% } %>
      
      <!-- InformaÃ§Ã£o do prÃ³ximo convocado -->
      <% if (proximoConvocado) { %>
        <div class="alert alert-success" style="margin-top: 15px;">
          <h3>ğŸ¯ PrÃ³ximo a levar os coletes:</h3>
          <p><strong><%= proximoConvocado.nome %></strong></p>
          <p>
            Vezes que jÃ¡ levou: <strong><%= proximoConvocado.vezes_levou %></strong>
            <% if (proximoConvocado.ultima_vez) { %>
              | Ãšltima vez: <%= new Date(proximoConvocado.ultima_vez).toLocaleDateString('pt-PT') %>
            <% } else { %>
              | <em>Nunca levou os coletes</em>
            <% } %>
          </p>
          <% if (!coletesActuais) { %>
            <form method="POST" action="/coletes/atribuir" style="margin-top: 10px;">
              <input type="hidden" name="jogador_id" value="<%= proximoConvocado.id %>">
              <button type="submit" class="btn btn-primary">
                ğŸ“¥ Atribuir Coletes a <%= proximoConvocado.nome %>
              </button>
            </form>
          <% } %>
        </div>
      <% } %>
    </div>    <!-- Tabela de estatÃ­sticas -->
    <div class="coletes-stats card-visual">
      <h3>ğŸ“Š EstatÃ­sticas dos Convocados</h3>
      <p><em>Apenas os 10 convocados podem levar os coletes</em></p>
      <% if (estatisticas.length > 0) { %>
        <table class="table stats-table">
          <thead>
            <tr>
              <th>PosiÃ§Ã£o</th>
              <th>Jogador</th>
              <th>PosiÃ§Ã£o ConvocatÃ³ria</th>
              <th>Vezes que Levou</th>
              <th>Ãšltima Vez</th>
              <th>Prioridade</th>
              <th>AcÃ§Ã£o</th>
            </tr>
          </thead>
          <tbody>
            <% estatisticas.forEach((jogador, index) => { %>
              <tr class="<%= index < 3 ? 'priority-high' : '' %> <%= index % 2 === 0 ? 'zebra' : '' %>">
                <td><%= index + 1 %>Âº</td>
                <td><%= jogador.nome %></td>
                <td><%= jogador.posicao %>Âº Convocado</td>
                <td><%= jogador.vezes_levou %></td>
                <td>
                  <% if (jogador.ultima_vez) { %>
                    <%= new Date(jogador.ultima_vez).toLocaleDateString('pt-PT') %>
                  <% } else { %>
                    <em>Nunca</em>
                  <% } %>
                </td>
                <td>
                  <% if (index === 0) { %>
                    <span class="priority-badge high">ğŸ”¥ ALTA</span>
                  <% } else if (index < 3) { %>
                    <span class="priority-badge medium">âš¡ MÃ‰DIA</span>
                  <% } else { %>
                    <span class="priority-badge low">ğŸ’¤ BAIXA</span>
                  <% } %>
                </td>
                <td>
                  <% if (!coletesActuais) { %>
                    <form method="POST" action="/coletes/atribuir" style="display: inline;">
                      <input type="hidden" name="jogador_id" value="<%= jogador.id %>">
                      <button type="submit" class="btn btn-primary btn-sm">
                        ğŸ“¥ Atribuir Coletes
                      </button>
                    </form>
                  <% } %>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      <% } else { %>
        <p>Nenhum jogador disponÃ­vel.</p>
      <% } %>
    </div>

    <!-- SugestÃ£o automÃ¡tica -->
    <% if (!coletesActuais && estatisticas.length > 0) { %>
      <div class="suggestion">
        <h3>ğŸ’¡ SugestÃ£o AutomÃ¡tica</h3>
        <p>PrÃ³ximo jogador sugerido: <strong><%= estatisticas[0].nome %></strong></p>
        <p>
          <% if (estatisticas[0].vezes_levou === 0) { %>
            (Nunca levou os coletes)
          <% } else { %>
            (Levou <%= estatisticas[0].vezes_levou %> vez<%= estatisticas[0].vezes_levou > 1 ? 'es' : '' %>)
          <% } %>
        </p>
        
        <form method="POST" action="/coletes/atribuir">
          <input type="hidden" name="jogador_id" value="<%= estatisticas[0].id %>">
          <button type="submit" class="btn btn-primary btn-large">
            ğŸ¯ Atribuir ao PrÃ³ximo da Lista
          </button>
        </form>
      </div>    <% } %>
  </main>
</body>
</html>
